<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin ‚Äì architekturb√ºro schels</title>
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <style>
:root{
  --bg:#fff;--sidebar:#fafafa;--text:#000;--border:#e0e0e0;--accent:#000;--hover:#f0f0f0;--success:#2e7d32;--error:#c62828;
  /* Editor Typography - synced with style panel */
  --ed-font:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  --ed-size:1em;
  --ed-weight:200;
  --ed-line-height:1.6;
  --ed-h2-size:1.4em;
  --ed-h3-size:1.2em;
  --ed-spacing:0.2em;
  --ed-p-margin:1rem;
  --ed-h-margin:2rem;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.5;height:100vh;overflow:hidden}
.login-screen{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--sidebar)}
.login-box{background:var(--bg);padding:3rem;max-width:360px;width:100%;border:1px solid var(--border)}
.login-box h1{font-weight:200;font-size:1.3rem;letter-spacing:.2em;margin-bottom:.5rem}
.login-box h1 span{display:block;font-size:1.5rem}
.login-box .subtitle{font-size:.85rem;color:#666;margin-bottom:2rem}
input[type="password"],input[type="text"],input[type="number"],select,textarea{width:100%;padding:.6rem .8rem;border:1px solid var(--border);font-size:.9rem;font-family:inherit;margin-bottom:.6rem;background:var(--bg);color:var(--text);border-radius:0}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent)}
textarea{min-height:80px;resize:vertical}
button{padding:.6rem 1.2rem;background:var(--accent);color:var(--bg);border:none;cursor:pointer;font-size:.85rem;letter-spacing:.02em;transition:opacity .2s;border-radius:0}
button:hover{opacity:.8}
button:disabled{opacity:.4;cursor:not-allowed}
.btn-secondary{background:var(--bg);color:var(--text);border:1px solid var(--border)}
.btn-small{padding:.35rem .7rem;font-size:.75rem}
.btn-success{background:var(--success)}
.error{color:var(--error);font-size:.8rem;margin-top:.3rem}
.success{color:var(--success);font-size:.8rem}
.admin-layout{display:none;height:100vh}
.admin-layout.active{display:flex}
.sidebar{width:200px;background:var(--sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.sidebar-header{padding:1.2rem;border-bottom:1px solid var(--border)}
.sidebar-header h1{font-weight:200;font-size:.9rem;letter-spacing:.12em}
.sidebar-header h1 span{font-weight:400}
.sidebar-nav{flex:1;overflow-y:auto;padding:.3rem 0}
.nav-section{padding:.5rem 1rem;font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:#999;margin-top:.8rem}
.nav-item{display:block;padding:.55rem 1.2rem;color:var(--text);text-decoration:none;font-size:.85rem;border-left:3px solid transparent;transition:all .12s}
.nav-item:hover{background:var(--hover)}
.nav-item.active{background:var(--hover);border-left-color:var(--accent);font-weight:500}
.sidebar-footer{padding:.8rem;border-top:1px solid var(--border);font-size:.75rem}
.sidebar-footer button{width:100%;margin-bottom:.4rem}
.autosave-status{color:#999;text-align:center;font-size:.7rem}
.main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}
.main-header{padding:.8rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--bg)}
.main-header h2{font-weight:400;font-size:1rem;letter-spacing:.04em}
.header-actions{display:flex;gap:.4rem;align-items:center}
.main-body{flex:1;overflow-y:auto;padding:1.2rem}
.panel{display:none}
.panel.active{display:block}
.editor-group{margin-bottom:1.5rem}
.editor-group>label{display:block;font-size:.7rem;text-transform:uppercase;letter-spacing:.06em;color:#666;margin-bottom:.4rem}
.editor-group .hint{font-size:.75rem;color:#999;margin-top:.2rem}

/* Quill Editor - Typographic Styles */
.quill-container{background:var(--bg);border:1px solid var(--border)}
.quill-container .ql-toolbar{border:none;border-bottom:1px solid var(--border);background:var(--sidebar);padding:.5rem}
.quill-container .ql-container{border:none;font-family:var(--ed-font);font-size:var(--ed-size)}
.quill-container .ql-editor{
  min-height:120px;
  max-height:350px;
  padding:1.5rem;
  font-weight:var(--ed-weight);
  line-height:var(--ed-line-height);
  color:var(--text);
}
.quill-container .ql-editor:focus{outline:none}
.quill-container .ql-editor.ql-blank::before{color:#aaa;font-style:normal}
/* Paragraphs */
.quill-container .ql-editor p{
  margin:0;
  margin-bottom:var(--ed-p-margin);
}
.quill-container .ql-editor p:last-child{margin-bottom:0}
/* Headings */
.quill-container .ql-editor h2{
  font-size:var(--ed-h2-size);
  font-weight:var(--ed-weight);
  letter-spacing:var(--ed-spacing);
  text-transform:uppercase;
  margin:var(--ed-h-margin) 0 calc(var(--ed-p-margin) * 0.75);
}
.quill-container .ql-editor h2:first-child{margin-top:0}
.quill-container .ql-editor h3{
  font-size:var(--ed-h3-size);
  font-weight:var(--ed-weight);
  letter-spacing:var(--ed-spacing);
  text-transform:uppercase;
  margin:var(--ed-h-margin) 0 calc(var(--ed-p-margin) * 0.75);
}
.quill-container .ql-editor h3:first-child{margin-top:0}
/* Lists */
.quill-container .ql-editor ul,.quill-container .ql-editor ol{
  margin:0 0 var(--ed-p-margin);
  padding-left:1.5rem;
}
.quill-container .ql-editor li{
  margin-bottom:calc(var(--ed-p-margin) * 0.5);
  padding-left:.25rem;
}
.quill-container .ql-editor li:last-child{margin-bottom:0}
/* Inline styles */
.quill-container .ql-editor strong{
  font-weight:400;
  text-transform:uppercase;
  letter-spacing:.08em;
}
.quill-container .ql-editor em{font-style:italic}
.quill-container .ql-editor u{text-decoration:underline;text-underline-offset:2px}
/* Small Caps */
.quill-container .ql-editor .smallcaps{font-variant:small-caps;letter-spacing:.05em}
.ql-smallcaps{font-size:11px !important}
.ql-smallcaps::after{content:'Aa';font-variant:small-caps}
.quill-container .ql-editor a{color:var(--text);text-decoration:underline;text-decoration-style:dotted}
/* Tables (for Vita) */
.quill-container .ql-editor table{width:100%;border-collapse:collapse;margin:var(--ed-p-margin) 0}
.quill-container .ql-editor td{padding:.5rem;vertical-align:top;border-bottom:1px solid var(--border)}
/* Blockquotes */
.quill-container .ql-editor blockquote{
  margin:var(--ed-p-margin) 0;
  padding-left:1rem;
  border-left:2px solid var(--text);
  font-style:italic;
}
/* Tall variant */
.quill-container.tall .ql-editor{min-height:300px;max-height:500px}

/* Style Preview Box */
.style-preview{
  margin:1rem 0;
  padding:1.5rem;
  border:1px solid var(--border);
  background:var(--bg);
  font-family:var(--ed-font);
  font-size:var(--ed-size);
  font-weight:var(--ed-weight);
  line-height:var(--ed-line-height);
}
.style-preview h3{
  font-size:var(--ed-h3-size);
  font-weight:var(--ed-weight);
  letter-spacing:var(--ed-spacing);
  text-transform:uppercase;
  margin:0 0 calc(var(--ed-p-margin) * 0.75);
}
.style-preview p{margin:0 0 var(--ed-p-margin)}
.style-preview p:last-child{margin-bottom:0}
.style-preview strong{font-weight:400;text-transform:uppercase;letter-spacing:.08em}

.section-title{font-size:.9rem;font-weight:500;margin:1.5rem 0 1rem;padding-bottom:.4rem;border-bottom:1px solid var(--border)}
.section-title:first-child{margin-top:0}
.style-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.8rem;margin-bottom:1rem}
.style-item{display:flex;flex-direction:column;gap:.2rem}
.style-item label{font-size:.65rem;text-transform:uppercase;letter-spacing:.04em;color:#666}
.style-item input[type="color"]{width:100%;height:32px;padding:1px;cursor:pointer;border:1px solid var(--border)}
.style-item input[type="text"],.style-item select{padding:.45rem .6rem;font-size:.85rem}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.status-bar{position:fixed;bottom:0;left:200px;right:0;padding:.6rem 1.2rem;background:var(--accent);color:var(--bg);display:none;font-size:.85rem}
.status-bar.error{background:var(--error)}
.status-bar.success{background:var(--success)}
.status-bar.active{display:flex;justify-content:space-between;align-items:center}
.unsaved-indicator{display:none;width:8px;height:8px;background:orange;border-radius:50%;margin-left:.5rem}
.unsaved-indicator.active{display:inline-block}
@media(max-width:768px){.sidebar{width:160px}.main-body{padding:.8rem}.style-grid{grid-template-columns:1fr}.two-col{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Login -->
  <div id="login-screen" class="login-screen">
    <div class="login-box">
      <h1>architekturb√ºro<span>schels</span></h1>
      <p class="subtitle">Admin Panel</p>
      <form id="login-form">
        <input type="password" id="password" placeholder="Passwort" required>
        <button type="submit" style="width:100%">Anmelden</button>
        <div id="login-error" class="error"></div>
      </form>
      <div id="setup-box" style="display:none">
        <p style="margin-bottom:.8rem;font-size:.85rem">Erstes Login ‚Äì Passwort festlegen:</p>
        <input type="password" id="new-password" placeholder="Neues Passwort">
        <input type="password" id="confirm-password" placeholder="Passwort best√§tigen">
        <button type="button" id="set-pw-btn" style="width:100%">Passwort setzen</button>
        <div id="setup-error" class="error"></div>
      </div>
    </div>
  </div>

  <!-- Admin -->
  <div id="admin-layout" class="admin-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>architekturb√ºro <span>schels</span></h1>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">Inhalte</div>
        <a href="#" class="nav-item active" data-panel="profil">Profil</a>
        <a href="#" class="nav-item" data-panel="vita">Vita</a>
        <a href="#" class="nav-item" data-panel="leistungen">Leistungen</a>
        <a href="#" class="nav-item" data-panel="referenzen">Referenzen</a>
        <a href="#" class="nav-item" data-panel="kontakt">Kontakt</a>
        <div class="nav-section">Rechtliches</div>
        <a href="#" class="nav-item" data-panel="impressum">Impressum</a>
        <a href="#" class="nav-item" data-panel="datenschutz">Datenschutz</a>
        <div class="nav-section">Design & SEO</div>
        <a href="#" class="nav-item" data-panel="seo">SEO & Meta-Tags</a>
        <a href="#" class="nav-item" data-panel="stile">Stile & Typografie</a>
        <div class="nav-section">System</div>
        <a href="#" class="nav-item" data-panel="einstellungen">Einstellungen</a>
      </nav>
      <div class="sidebar-footer">
        <button id="save-btn" class="btn-success">üíæ Speichern & Ver√∂ffentlichen</button>
        <button id="logout-btn" class="btn-secondary">Abmelden</button>
        <div class="autosave-status">Auto-Save: <span id="autosave-time">-</span></div>
      </div>
    </aside>

    <main class="main-content">
      <header class="main-header">
        <h2 id="panel-title">Profil <span class="unsaved-indicator" id="unsaved"></span></h2>
        <div class="header-actions">
          <button id="preview-btn" class="btn-secondary btn-small">Vorschau ‚Üó</button>
        </div>
      </header>

      <div class="main-body">
        <!-- Profil -->
        <div id="profil-panel" class="panel active">
          <div class="editor-group">
            <label>√úberblick</label>
            <div class="quill-container"><div id="ed-profil-ueberblick"></div></div>
          </div>
          <div class="editor-group">
            <label>Arbeitsweise</label>
            <div class="quill-container"><div id="ed-profil-arbeitsweise"></div></div>
          </div>
          <div class="editor-group">
            <label>Schwerpunkte</label>
            <div class="quill-container"><div id="ed-profil-schwerpunkte"></div></div>
          </div>
          <div class="editor-group">
            <label>Philosophie</label>
            <div class="quill-container"><div id="ed-profil-philosophie"></div></div>
          </div>
        </div>

        <!-- Vita -->
        <div id="vita-panel" class="panel">
          <div class="editor-group">
            <label>Lebenslauf</label>
            <div class="quill-container tall"><div id="ed-vita"></div></div>
            <p class="hint">Formatiere als Tabelle oder Liste mit Zeitr√§umen</p>
          </div>
        </div>

        <!-- Leistungen -->
        <div id="leistungen-panel" class="panel">
          <div class="editor-group">
            <label>Leistungen (kompletter Inhalt)</label>
            <div class="quill-container tall"><div id="ed-leistungen"></div></div>
          </div>
        </div>

        <!-- Referenzen -->
        <div id="referenzen-panel" class="panel">
          <div class="editor-group">
            <label>Referenzen (kompletter Inhalt)</label>
            <div class="quill-container tall"><div id="ed-referenzen"></div></div>
          </div>
        </div>

        <!-- Kontakt -->
        <div id="kontakt-panel" class="panel">
          <div class="editor-group">
            <label>Begr√º√üungstext</label>
            <div class="quill-container"><div id="ed-kontakt-intro"></div></div>
          </div>
          <div class="two-col">
            <div class="editor-group">
              <label>E-Mail</label>
              <input type="text" id="kontakt-email">
            </div>
            <div class="editor-group">
              <label>Telefon</label>
              <input type="text" id="kontakt-telefon">
            </div>
          </div>
          <div class="editor-group">
            <label>Adresse</label>
            <input type="text" id="kontakt-adresse">
          </div>
        </div>

        <!-- Impressum -->
        <div id="impressum-panel" class="panel">
          <div class="editor-group">
            <label>Impressum (HTML)</label>
            <div class="quill-container tall"><div id="ed-impressum"></div></div>
            <p class="hint">Wird in pages/impressum.html gespeichert</p>
          </div>
        </div>

        <!-- Datenschutz -->
        <div id="datenschutz-panel" class="panel">
          <div class="editor-group">
            <label>Datenschutzerkl√§rung (HTML)</label>
            <div class="quill-container tall"><div id="ed-datenschutz"></div></div>
            <p class="hint">Wird in pages/datenschutz.html gespeichert</p>
          </div>
        </div>

        <!-- SEO -->
        <div id="seo-panel" class="panel">
          <div class="section-title">Meta-Tags</div>
          <div class="editor-group">
            <label>Seitentitel (Title Tag)</label>
            <input type="text" id="seo-title">
            <p class="hint">Empfohlen: 50-60 Zeichen</p>
          </div>
          <div class="editor-group">
            <label>Beschreibung (Meta Description)</label>
            <textarea id="seo-description"></textarea>
            <p class="hint">Empfohlen: 150-160 Zeichen</p>
          </div>
          <div class="editor-group">
            <label>Keywords</label>
            <textarea id="seo-keywords"></textarea>
            <p class="hint">Kommagetrennt</p>
          </div>
          <div class="section-title">Open Graph (Social Media)</div>
          <div class="editor-group">
            <label>OG Title</label>
            <input type="text" id="seo-og-title">
          </div>
          <div class="editor-group">
            <label>OG Description</label>
            <textarea id="seo-og-description"></textarea>
          </div>
        </div>

        <!-- Stile -->
        <div id="stile-panel" class="panel">
          <div class="section-title">Typografie ‚Äì Flie√ütext</div>
          <div class="style-grid">
            <div class="style-item"><label>Schriftfamilie</label>
              <select id="st-font">
                <option value="-apple-system,BlinkMacSystemFont,'Avenir Next','Segoe UI',sans-serif">System (Standard)</option>
                <option value="'Helvetica Neue',Helvetica,Arial,sans-serif">Helvetica</option>
                <option value="Georgia,'Times New Roman',serif">Georgia (Serif)</option>
              </select>
            </div>
            <div class="style-item"><label>Schriftgr√∂√üe</label>
              <select id="st-fontsize">
                <option value="0.9em">Klein (0.9em)</option>
                <option value="1em" selected>Normal (1em)</option>
                <option value="1.1em">Gro√ü (1.1em)</option>
              </select>
            </div>
            <div class="style-item"><label>Schriftgewicht</label>
              <select id="st-weight">
                <option value="100">Ultraleicht (100)</option>
                <option value="200" selected>Leicht (200)</option>
                <option value="300">Light (300)</option>
                <option value="400">Normal (400)</option>
              </select>
            </div>
            <div class="style-item"><label>Zeilenh√∂he</label>
              <select id="st-lineheight">
                <option value="1.4">Eng (1.4)</option>
                <option value="1.6" selected>Normal (1.6)</option>
                <option value="1.8">Locker (1.8)</option>
                <option value="2.0">Weit (2.0)</option>
              </select>
            </div>
          </div>

          <div class="section-title">Abst√§nde</div>
          <div class="style-grid">
            <div class="style-item"><label>Absatz-Abstand</label>
              <select id="st-p-margin">
                <option value="0.5rem">Minimal (0.5rem)</option>
                <option value="0.75rem">Klein (0.75rem)</option>
                <option value="1rem" selected>Normal (1rem)</option>
                <option value="1.25rem">Gro√ü (1.25rem)</option>
                <option value="1.5rem">Sehr gro√ü (1.5rem)</option>
              </select>
            </div>
            <div class="style-item"><label>√úberschrift-Abstand oben</label>
              <select id="st-h-margin">
                <option value="1.5rem">Klein (1.5rem)</option>
                <option value="2rem">Normal (2rem)</option>
                <option value="2.5rem" selected>Gro√ü (2.5rem)</option>
                <option value="3rem">Sehr gro√ü (3rem)</option>
              </select>
            </div>
          </div>

          <div class="section-title">√úberschriften</div>
          <div class="style-grid">
            <div class="style-item"><label>H2 Gr√∂√üe</label>
              <select id="st-h2">
                <option value="1.2em">Klein (1.2em)</option>
                <option value="1.4em" selected>Normal (1.4em)</option>
                <option value="1.6em">Gro√ü (1.6em)</option>
              </select>
            </div>
            <div class="style-item"><label>H3 Gr√∂√üe</label>
              <select id="st-h3">
                <option value="1.0em">Klein (1.0em)</option>
                <option value="1.2em" selected>Normal (1.2em)</option>
                <option value="1.4em">Gro√ü (1.4em)</option>
              </select>
            </div>
            <div class="style-item"><label>Letter-Spacing</label>
              <select id="st-spacing">
                <option value="0.1em">Eng (0.1em)</option>
                <option value="0.15em">Normal (0.15em)</option>
                <option value="0.2em" selected>Weit (0.2em)</option>
                <option value="0.25em">Sehr weit (0.25em)</option>
              </select>
            </div>
          </div>

          <div class="section-title">Live-Vorschau</div>
          <div class="style-preview" id="style-preview">
            <h3>√úberschrift Beispiel</h3>
            <p>Dies ist ein Beispiel-Absatz mit normalem Flie√ütext. <strong>architekturb√ºro schels</strong> begleitet Bauvorhaben vom ersten Entwurf bis zur Umsetzung.</p>
            <p>Ein zweiter Absatz zeigt den Abstand zwischen den Abs√§tzen. Die <em>Typografie</em> sollte der Website entsprechen.</p>
          </div>

          <div class="section-title">Farben (Light Mode)</div>
          <div class="style-grid">
            <div class="style-item"><label>Hintergrund</label><input type="color" id="st-bg" value="#ffffff"></div>
            <div class="style-item"><label>Text</label><input type="color" id="st-text" value="#000000"></div>
            <div class="style-item"><label>Akzent</label><input type="color" id="st-accent" value="#0000ff"></div>
            <div class="style-item"><label>Sekund√§r</label><input type="color" id="st-secondary" value="#555555"></div>
          </div>

          <div class="section-title">Farben (Dark Mode)</div>
          <div class="style-grid">
            <div class="style-item"><label>Hintergrund</label><input type="color" id="st-bg-dark" value="#111111"></div>
            <div class="style-item"><label>Text</label><input type="color" id="st-text-dark" value="#e5e5e5"></div>
            <div class="style-item"><label>Akzent</label><input type="color" id="st-accent-dark" value="#4d9fff"></div>
          </div>

          <div class="section-title">Layout</div>
          <div class="style-grid">
            <div class="style-item"><label>Seitenbreite</label><input type="text" id="st-width" value="70%"></div>
            <div class="style-item"><label>Max-Breite</label><input type="text" id="st-maxwidth" value="60em"></div>
          </div>
        </div>

        <!-- Einstellungen -->
        <div id="einstellungen-panel" class="panel">
          <div class="section-title">GitHub Verbindung</div>
          <p style="font-size:.85rem;color:#666;margin-bottom:1rem">√Ñnderungen werden direkt in dein Repository geschrieben.</p>
          <div class="editor-group">
            <label>Personal Access Token</label>
            <input type="password" id="github-token" placeholder="ghp_...">
            <p class="hint"><a href="https://github.com/settings/tokens/new?scopes=repo&description=Admin%20Panel" target="_blank">Token erstellen ‚Üí</a> (repo Berechtigung)</p>
          </div>
          <div class="two-col">
            <div class="editor-group"><label>Repository</label><input type="text" id="github-repo" value="bschels/bschels.github.io"></div>
            <div class="editor-group"><label>Branch</label><input type="text" id="github-branch" value="main"></div>
          </div>
          <button id="test-github" class="btn-secondary">Verbindung testen</button>
          <span id="github-status" style="margin-left:.5rem;font-size:.85rem"></span>

          <div class="section-title" style="margin-top:2rem">Passwort √§ndern</div>
          <div class="two-col">
            <div class="editor-group"><label>Aktuelles Passwort</label><input type="password" id="pw-current"></div>
            <div class="editor-group"><label>Neues Passwort</label><input type="password" id="pw-new"></div>
          </div>
          <button id="change-pw" class="btn-secondary">Passwort √§ndern</button>
          <span id="pw-status" style="margin-left:.5rem;font-size:.85rem"></span>

          <div class="section-title" style="margin-top:2rem">Auto-Save</div>
          <div class="editor-group">
            <label>Intervall</label>
            <select id="autosave-interval">
              <option value="0">Deaktiviert</option>
              <option value="30">Alle 30 Sekunden</option>
              <option value="60" selected>Alle 60 Sekunden</option>
              <option value="120">Alle 2 Minuten</option>
            </select>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="status-bar" class="status-bar"></div>

  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script>
(function(){
  'use strict';
  const $=id=>document.getElementById(id),$$=s=>document.querySelectorAll(s);
  const hash=s=>s.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0).toString(16);
  
  // Register Small Caps format
  const Inline=Quill.import('blots/inline');
  class SmallCapsBlot extends Inline{
    static create(){const node=super.create();node.classList.add('smallcaps');return node;}
    static formats(node){return node.classList.contains('smallcaps');}
  }
  SmallCapsBlot.blotName='smallcaps';
  SmallCapsBlot.tagName='span';
  Quill.register(SmallCapsBlot);
  
  let editors={},hasChanges=false,autoSaveTimer=null;
  const toolbarOpts=[['bold','italic','underline','smallcaps'],['link'],[{'list':'bullet'},{'list':'ordered'}],[{'header':[2,3,false]}],['clean']];
  
  // Init
  function init(){
    if(!localStorage.getItem('admin_pw')){$('login-form').style.display='none';$('setup-box').style.display='block';}
    if(sessionStorage.getItem('admin_auth'))showAdmin();
    bindEvents();
  }
  
  function bindEvents(){
    $('set-pw-btn').onclick=()=>{
      const pw=$('new-password').value,c=$('confirm-password').value;
      if(pw.length<4)return $('setup-error').textContent='Mind. 4 Zeichen';
      if(pw!==c)return $('setup-error').textContent='Passw√∂rter stimmen nicht √ºberein';
      localStorage.setItem('admin_pw',hash(pw));location.reload();
    };
    $('login-form').onsubmit=e=>{
      e.preventDefault();
      if(hash($('password').value)===localStorage.getItem('admin_pw')){
        sessionStorage.setItem('admin_auth','1');showAdmin();
      }else $('login-error').textContent='Falsches Passwort';
    };
    $('logout-btn').onclick=()=>{sessionStorage.removeItem('admin_auth');location.reload();};
    $$('.nav-item').forEach(n=>n.onclick=e=>{
      e.preventDefault();
      $$('.nav-item').forEach(i=>i.classList.remove('active'));
      $$('.panel').forEach(p=>p.classList.remove('active'));
      n.classList.add('active');
      $(n.dataset.panel+'-panel').classList.add('active');
      $('panel-title').innerHTML=n.textContent+'<span class="unsaved-indicator'+(hasChanges?' active':'')+'"></span>';
    });
    $('save-btn').onclick=saveAll;
    $('preview-btn').onclick=()=>window.open('/','_blank');
    $('test-github').onclick=testGitHub;
    $('change-pw').onclick=changePw;
    $('autosave-interval').onchange=setupAutoSave;
    
    // Style inputs - update CSS variables live
    $$('[id^="st-"]').forEach(el=>{
      el.addEventListener('input',()=>{
        updateEditorStyles();
        markChanged();
      });
      el.addEventListener('change',()=>{
        updateEditorStyles();
        markChanged();
      });
    });
  }
  
  function updateEditorStyles(){
    const root=document.documentElement;
    const font=$('st-font')?.value;
    const size=$('st-fontsize')?.value;
    const weight=$('st-weight')?.value;
    const lineHeight=$('st-lineheight')?.value;
    const h2=$('st-h2')?.value;
    const h3=$('st-h3')?.value;
    const spacing=$('st-spacing')?.value;
    const pMargin=$('st-p-margin')?.value;
    const hMargin=$('st-h-margin')?.value;
    
    if(font)root.style.setProperty('--ed-font',font);
    if(size)root.style.setProperty('--ed-size',size);
    if(weight)root.style.setProperty('--ed-weight',weight);
    if(lineHeight)root.style.setProperty('--ed-line-height',lineHeight);
    if(h2)root.style.setProperty('--ed-h2-size',h2);
    if(h3)root.style.setProperty('--ed-h3-size',h3);
    if(spacing)root.style.setProperty('--ed-spacing',spacing);
    if(pMargin)root.style.setProperty('--ed-p-margin',pMargin);
    if(hMargin)root.style.setProperty('--ed-h-margin',hMargin);
  }
  
  function showAdmin(){
    $('login-screen').style.display='none';
    $('admin-layout').classList.add('active');
    initEditors();
    loadSettings();
    loadContent();
    setupAutoSave();
    updateEditorStyles();
  }
  
  function initEditors(){
    ['profil-ueberblick','profil-arbeitsweise','profil-schwerpunkte','profil-philosophie','vita','leistungen','referenzen','kontakt-intro','impressum','datenschutz'].forEach(id=>{
      const el=$('ed-'+id);
      if(el){
        const q=new Quill(el,{theme:'snow',modules:{toolbar:toolbarOpts},placeholder:'Text eingeben...'});
        // Add smallcaps handler
        const toolbar=q.getModule('toolbar');
        toolbar.addHandler('smallcaps',function(){
          const range=q.getSelection();
          if(range){
            const format=q.getFormat(range);
            q.format('smallcaps',!format.smallcaps);
          }
        });
        q.on('text-change',()=>markChanged());
        editors[id]=q;
      }
    });
    $$('input:not([id^="st-"]),textarea,select:not([id^="st-"])').forEach(el=>el.addEventListener('input',markChanged));
  }
  
  function markChanged(){
    hasChanges=true;
    $('unsaved')?.classList.add('active');
  }
  
  function loadSettings(){
    $('github-token').value=localStorage.getItem('gh_token')||'';
    $('github-repo').value=localStorage.getItem('gh_repo')||'bschels/bschels.github.io';
    $('github-branch').value=localStorage.getItem('gh_branch')||'main';
    $('autosave-interval').value=localStorage.getItem('autosave')||'60';
    
    // Load saved styles
    const savedStyles=localStorage.getItem('ed_styles');
    if(savedStyles){
      try{
        const styles=JSON.parse(savedStyles);
        Object.keys(styles).forEach(k=>{
          const el=$('st-'+k);
          if(el)el.value=styles[k];
        });
      }catch(e){}
    }
  }
  
  async function loadContent(){
    showStatus('Lade Inhalte...');
    try{
      const indexRes=await fetch('/index.html?t='+Date.now());
      if(!indexRes.ok)throw new Error('index.html nicht gefunden');
      const indexHtml=await indexRes.text();
      const doc=new DOMParser().parseFromString(indexHtml,'text/html');
      
      extractFromDoc(doc);
      
      try{
        const impRes=await fetch('/pages/impressum.html?t='+Date.now());
        if(impRes.ok&&editors.impressum)editors.impressum.root.innerHTML=await impRes.text();
      }catch(e){}
      
      try{
        const dsRes=await fetch('/pages/datenschutz.html?t='+Date.now());
        if(dsRes.ok&&editors.datenschutz)editors.datenschutz.root.innerHTML=await dsRes.text();
      }catch(e){}
      
      $('seo-title').value=doc.querySelector('title')?.textContent||'';
      $('seo-description').value=doc.querySelector('meta[name="description"]')?.content||'';
      $('seo-keywords').value=doc.querySelector('meta[name="keywords"]')?.content||'';
      $('seo-og-title').value=doc.querySelector('meta[property="og:title"]')?.content||'';
      $('seo-og-description').value=doc.querySelector('meta[property="og:description"]')?.content||'';
      
      const kontaktDiv=doc.querySelector('#content5');
      if(kontaktDiv){
        const intro=kontaktDiv.querySelector('p.content');
        if(intro&&editors['kontakt-intro'])editors['kontakt-intro'].root.innerHTML=intro.innerHTML;
        const emailLink=kontaktDiv.querySelector('a[href^="mailto:"]');
        if(emailLink)$('kontakt-email').value=emailLink.textContent;
        const telLink=kontaktDiv.querySelector('a[href^="tel:"]');
        if(telLink)$('kontakt-telefon').value=telLink.textContent;
        const addrLink=kontaktDiv.querySelector('a[href*="maps.google"]');
        if(addrLink)$('kontakt-adresse').value=addrLink.textContent;
      }
      
      hasChanges=false;
      showStatus('Inhalte geladen ‚úì','success');
      setTimeout(hideStatus,2000);
    }catch(e){
      console.error(e);
      showStatus('Fehler: '+e.message,'error');
    }
  }
  
  function extractFromDoc(doc){
    const profil=doc.querySelector('#content1');
    if(profil){
      const sections={ueberblick:[],arbeitsweise:[],schwerpunkte:[],philosophie:[]};
      let current='ueberblick';
      profil.querySelectorAll('h3,p:not(.cv-role):not(.cv-subtitle):not(.cta-link):not(.says)').forEach(el=>{
        if(el.tagName==='H3'){
          const t=el.textContent.toLowerCase();
          if(t.includes('arbeitsweise'))current='arbeitsweise';
          else if(t.includes('schwerpunkt'))current='schwerpunkte';
          else if(t.includes('philosophie'))current='philosophie';
        }else if(el.tagName==='P')sections[current].push(el.outerHTML);
      });
      Object.keys(sections).forEach(k=>{if(editors['profil-'+k])editors['profil-'+k].root.innerHTML=sections[k].join('');});
    }
    const vita=doc.querySelector('#content2');
    if(vita&&editors.vita){
      const table=vita.querySelector('table');
      const extra=vita.querySelector('table~p');
      editors.vita.root.innerHTML=(table?table.outerHTML:'')+(extra?extra.outerHTML:'');
    }
    const leist=doc.querySelector('#content3');
    if(leist&&editors.leistungen){
      let html='';
      leist.querySelectorAll('h3,p,ul').forEach(el=>html+=el.outerHTML);
      editors.leistungen.root.innerHTML=html;
    }
    const refs=doc.querySelector('#content4');
    if(refs&&editors.referenzen){
      let html='';
      refs.querySelectorAll('h3,table,p').forEach(el=>html+=el.outerHTML);
      editors.referenzen.root.innerHTML=html;
    }
  }
  
  async function saveAll(){
    const btn=$('save-btn');
    btn.disabled=true;btn.textContent='Speichert...';
    showStatus('Speichert...');
    
    const token=localStorage.getItem('gh_token')||$('github-token').value;
    if(!token){showStatus('GitHub Token fehlt!','error');btn.disabled=false;btn.textContent='üíæ Speichern & Ver√∂ffentlichen';return;}
    
    localStorage.setItem('gh_token',$('github-token').value);
    localStorage.setItem('gh_repo',$('github-repo').value);
    localStorage.setItem('gh_branch',$('github-branch').value);
    localStorage.setItem('autosave',$('autosave-interval').value);
    
    // Save styles to localStorage
    const styles={};
    $$('[id^="st-"]').forEach(el=>styles[el.id.replace('st-','')]=el.value);
    localStorage.setItem('ed_styles',JSON.stringify(styles));
    
    try{
      if(editors.impressum){
        await saveFile('pages/impressum.html',editors.impressum.root.innerHTML);
      }
      if(editors.datenschutz){
        await saveFile('pages/datenschutz.html',editors.datenschutz.root.innerHTML);
      }
      const data=collectAllData();
      await saveFile('admin-data.json',JSON.stringify(data,null,2));
      
      hasChanges=false;
      $('unsaved')?.classList.remove('active');
      $('autosave-time').textContent=new Date().toLocaleTimeString('de');
      showStatus('Gespeichert & ver√∂ffentlicht ‚úì','success');
      setTimeout(hideStatus,3000);
    }catch(e){
      console.error(e);
      showStatus('Fehler: '+e.message,'error');
    }
    btn.disabled=false;btn.textContent='üíæ Speichern & Ver√∂ffentlichen';
  }
  
  function collectAllData(){
    const data={content:{},seo:{},styles:{},contact:{},updated:new Date().toISOString()};
    Object.keys(editors).forEach(k=>data.content[k]=editors[k].root.innerHTML);
    data.seo={title:$('seo-title').value,description:$('seo-description').value,keywords:$('seo-keywords').value,ogTitle:$('seo-og-title').value,ogDescription:$('seo-og-description').value};
    data.contact={email:$('kontakt-email').value,telefon:$('kontakt-telefon').value,adresse:$('kontakt-adresse').value};
    $$('[id^="st-"]').forEach(el=>data.styles[el.id.replace('st-','')]=el.value);
    return data;
  }
  
  async function saveFile(path,content){
    const token=localStorage.getItem('gh_token');
    const repo=localStorage.getItem('gh_repo');
    const branch=localStorage.getItem('gh_branch')||'main';
    
    let sha;
    try{
      const r=await fetch(`https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`,{headers:{Authorization:`token ${token}`}});
      if(r.ok)sha=(await r.json()).sha;
    }catch(e){}
    
    const body={message:`Admin: ${path} aktualisiert`,content:btoa(unescape(encodeURIComponent(content))),branch};
    if(sha)body.sha=sha;
    
    const res=await fetch(`https://api.github.com/repos/${repo}/contents/${path}`,{
      method:'PUT',
      headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    if(!res.ok)throw new Error((await res.json()).message||'GitHub Fehler');
  }
  
  async function testGitHub(){
    const token=$('github-token').value;
    const repo=$('github-repo').value;
    try{
      const r=await fetch(`https://api.github.com/repos/${repo}`,{headers:{Authorization:`token ${token}`}});
      if(r.ok){
        $('github-status').innerHTML='<span class="success">‚úì Verbunden</span>';
        localStorage.setItem('gh_token',token);
        localStorage.setItem('gh_repo',repo);
        localStorage.setItem('gh_branch',$('github-branch').value);
      }else $('github-status').innerHTML='<span class="error">Fehler '+r.status+'</span>';
    }catch(e){$('github-status').innerHTML='<span class="error">Verbindungsfehler</span>';}
  }
  
  function changePw(){
    const curr=$('pw-current').value,newPw=$('pw-new').value;
    if(hash(curr)!==localStorage.getItem('admin_pw'))return $('pw-status').innerHTML='<span class="error">Falsches Passwort</span>';
    if(newPw.length<4)return $('pw-status').innerHTML='<span class="error">Mind. 4 Zeichen</span>';
    localStorage.setItem('admin_pw',hash(newPw));
    $('pw-status').innerHTML='<span class="success">‚úì Ge√§ndert</span>';
    $('pw-current').value='';$('pw-new').value='';
  }
  
  function setupAutoSave(){
    if(autoSaveTimer)clearInterval(autoSaveTimer);
    const interval=parseInt($('autosave-interval').value)*1000;
    localStorage.setItem('autosave',$('autosave-interval').value);
    if(interval>0){
      autoSaveTimer=setInterval(()=>{if(hasChanges)saveAll();},interval);
    }
  }
  
  function showStatus(msg,type=''){
    const el=$('status-bar');
    el.textContent=msg;
    el.className='status-bar active'+(type?' '+type:'');
  }
  function hideStatus(){$('status-bar').classList.remove('active');}
  
  init();
})();
  </script>
</body>
</html>
