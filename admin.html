<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin ‚Äì architekturb√ºro schels</title>
  <style>
:root{--bg:#fff;--sidebar:#fafafa;--text:#000;--border:#e0e0e0;--accent:#000;--hover:#f0f0f0;--success:#2e7d32;--error:#c62828;--warning:#f57c00}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.5;height:100vh;overflow:hidden}
.login-screen{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--sidebar)}
.login-box{background:var(--bg);padding:3rem;max-width:360px;width:100%;border:1px solid var(--border)}
.login-box h1{font-weight:200;font-size:1.3rem;letter-spacing:.2em;margin-bottom:.5rem}
.login-box h1 span{display:block;font-size:1.5rem}
.login-box .subtitle{font-size:.85rem;color:#666;margin-bottom:2rem}
input[type="password"],input[type="text"],input[type="number"],select,textarea{width:100%;padding:.6rem .8rem;border:1px solid var(--border);font-size:.9rem;font-family:inherit;margin-bottom:.6rem;background:var(--bg);color:var(--text);border-radius:0}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent)}
textarea{min-height:80px;resize:vertical}
button{padding:.6rem 1.2rem;background:var(--accent);color:var(--bg);border:none;cursor:pointer;font-size:.85rem;letter-spacing:.02em;transition:opacity .2s;border-radius:0}
button:hover{opacity:.8}
button:disabled{opacity:.4;cursor:not-allowed}
.btn-secondary{background:var(--bg);color:var(--text);border:1px solid var(--border)}
.btn-small{padding:.35rem .7rem;font-size:.75rem}
.btn-success{background:var(--success)}
.error{color:var(--error);font-size:.8rem;margin-top:.3rem}
.success{color:var(--success);font-size:.8rem}
.admin-layout{display:none;height:100vh}
.admin-layout.active{display:flex}
.sidebar{width:200px;background:var(--sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.sidebar-header{padding:1.2rem;border-bottom:1px solid var(--border)}
.sidebar-header h1{font-weight:200;font-size:.9rem;letter-spacing:.12em}
.sidebar-header h1 span{font-weight:400}
.sidebar-nav{flex:1;overflow-y:auto;padding:.3rem 0}
.nav-section{padding:.5rem 1rem;font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:#999;margin-top:.8rem}
.nav-item{display:block;padding:.55rem 1.2rem;color:var(--text);text-decoration:none;font-size:.85rem;border-left:3px solid transparent;transition:all .12s}
.nav-item:hover{background:var(--hover)}
.nav-item.active{background:var(--hover);border-left-color:var(--accent);font-weight:500}
.sidebar-footer{padding:.8rem;border-top:1px solid var(--border);font-size:.75rem}
.sidebar-footer button{width:100%;margin-bottom:.4rem}
.main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}
.main-header{padding:.8rem 1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:var(--bg)}
.main-header h2{font-weight:400;font-size:1rem;letter-spacing:.04em}
.header-actions{display:flex;gap:.4rem;align-items:center}
.main-body{flex:1;overflow-y:auto;padding:1.2rem}
.panel{display:none}
.panel.active{display:block}
.editor-group{margin-bottom:1.5rem}
.editor-group>label{display:block;font-size:.7rem;text-transform:uppercase;letter-spacing:.06em;color:#666;margin-bottom:.4rem}
.editor-group .hint{font-size:.75rem;color:#999;margin-top:.2rem}
.section-title{font-size:.9rem;font-weight:500;margin:1.5rem 0 1rem;padding-bottom:.4rem;border-bottom:1px solid var(--border)}
.section-title:first-child{margin-top:0}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.status-bar{position:fixed;bottom:0;left:200px;right:0;padding:.6rem 1.2rem;background:var(--accent);color:var(--bg);display:none;font-size:.85rem}
.status-bar.error{background:var(--error)}
.status-bar.success{background:var(--success)}
.status-bar.active{display:flex;justify-content:space-between;align-items:center}
.unsaved-indicator{display:none;width:8px;height:8px;background:orange;border-radius:50%;margin-left:.5rem}
.unsaved-indicator.active{display:inline-block}
.info-box{background:#fff8e1;border:1px solid #ffe082;padding:1rem;margin-bottom:1.5rem;font-size:.85rem}
.info-box.blue{background:#e3f2fd;border-color:#90caf9}
.info-box h4{margin:0 0 .5rem;font-weight:500}
.char-count{font-size:.75rem;color:#999;margin-top:.2rem}
.char-count.warning{color:var(--warning)}
.char-count.error{color:var(--error)}
@media(max-width:768px){.sidebar{width:160px}.main-body{padding:.8rem}.two-col{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Login -->
  <div id="login-screen" class="login-screen">
    <div class="login-box">
      <h1>architekturb√ºro<span>schels</span></h1>
      <p class="subtitle">Admin Panel</p>
      <form id="login-form">
        <input type="password" id="password" placeholder="Passwort" required>
        <button type="submit" style="width:100%">Anmelden</button>
        <div id="login-error" class="error"></div>
      </form>
      <div id="setup-box" style="display:none">
        <p style="margin-bottom:.8rem;font-size:.85rem">Erstes Login ‚Äì Passwort festlegen:</p>
        <input type="password" id="new-password" placeholder="Neues Passwort">
        <input type="password" id="confirm-password" placeholder="Passwort best√§tigen">
        <button type="button" id="set-pw-btn" style="width:100%">Passwort setzen</button>
        <div id="setup-error" class="error"></div>
      </div>
    </div>
  </div>

  <!-- Admin -->
  <div id="admin-layout" class="admin-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>architekturb√ºro <span>schels</span></h1>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">SEO</div>
        <a href="#" class="nav-item active" data-panel="seo">Meta-Tags</a>
        <a href="#" class="nav-item" data-panel="og">Open Graph</a>
        <div class="nav-section">Info</div>
        <a href="#" class="nav-item" data-panel="inhalte">Inhalte bearbeiten</a>
        <div class="nav-section">System</div>
        <a href="#" class="nav-item" data-panel="einstellungen">Einstellungen</a>
      </nav>
      <div class="sidebar-footer">
        <button id="save-btn" class="btn-success">üíæ SEO Speichern</button>
        <button id="logout-btn" class="btn-secondary">Abmelden</button>
      </div>
    </aside>

    <main class="main-content">
      <header class="main-header">
        <h2 id="panel-title">Meta-Tags <span class="unsaved-indicator" id="unsaved"></span></h2>
        <div class="header-actions">
          <button id="preview-btn" class="btn-secondary btn-small">Vorschau ‚Üó</button>
        </div>
      </header>

      <div class="main-body">
        <!-- SEO -->
        <div id="seo-panel" class="panel active">
          <div class="info-box blue">
            <h4>üí° SEO Meta-Tags</h4>
            Diese Felder beeinflussen, wie deine Website in Google-Suchergebnissen erscheint.
          </div>
          
          <div class="editor-group">
            <label>Seitentitel (Title Tag)</label>
            <input type="text" id="seo-title" oninput="updateCharCount(this, 60)">
            <div class="char-count" id="seo-title-count">0/60 Zeichen</div>
          </div>
          
          <div class="editor-group">
            <label>Beschreibung (Meta Description)</label>
            <textarea id="seo-description" rows="3" oninput="updateCharCount(this, 160)"></textarea>
            <div class="char-count" id="seo-description-count">0/160 Zeichen</div>
          </div>
          
          <div class="editor-group">
            <label>Keywords</label>
            <textarea id="seo-keywords" rows="2"></textarea>
            <p class="hint">Kommagetrennt, z.B.: Architekt Wolnzach, Denkmalpflege, Bauen im Bestand</p>
          </div>
        </div>

        <!-- Open Graph -->
        <div id="og-panel" class="panel">
          <div class="info-box blue">
            <h4>üì± Open Graph</h4>
            Diese Felder bestimmen, wie deine Website aussieht, wenn sie auf Social Media geteilt wird.
          </div>
          
          <div class="editor-group">
            <label>OG Title</label>
            <input type="text" id="seo-og-title" oninput="updateCharCount(this, 60)">
            <div class="char-count" id="seo-og-title-count">0/60 Zeichen</div>
          </div>
          
          <div class="editor-group">
            <label>OG Description</label>
            <textarea id="seo-og-description" rows="3" oninput="updateCharCount(this, 160)"></textarea>
            <div class="char-count" id="seo-og-description-count">0/160 Zeichen</div>
          </div>
        </div>

        <!-- Inhalte -->
        <div id="inhalte-panel" class="panel">
          <div class="info-box">
            <h4>‚ö†Ô∏è Inhalte bearbeiten</h4>
            <p>WYSIWYG-Editoren (wie Word) zerst√∂ren leider die HTML-Struktur deiner Website (Tabellen, Listen, CSS-Klassen).</p>
            <p style="margin-top:.5rem"><strong>Daher k√∂nnen Inhalte nur direkt in den HTML-Dateien bearbeitet werden:</strong></p>
          </div>
          
          <div class="section-title">Hauptseite (index.html)</div>
          <ul style="margin-left:1.5rem;font-size:.9rem;line-height:1.8">
            <li><strong>Profil</strong> ‚Äì Abschnitt #content1</li>
            <li><strong>Vita</strong> ‚Äì Abschnitt #content2 (enth√§lt Tabelle)</li>
            <li><strong>Leistungen</strong> ‚Äì Abschnitt #content3 (enth√§lt Listen)</li>
            <li><strong>Referenzen</strong> ‚Äì Abschnitt #content4 (enth√§lt Tabelle)</li>
            <li><strong>Kontakt</strong> ‚Äì Abschnitt #content5</li>
          </ul>
          
          <div class="section-title">Unterseiten</div>
          <ul style="margin-left:1.5rem;font-size:.9rem;line-height:1.8">
            <li><strong>Impressum</strong> ‚Äì pages/impressum.html</li>
            <li><strong>Datenschutz</strong> ‚Äì pages/datenschutz.html</li>
          </ul>
          
          <div style="margin-top:2rem;padding:1rem;background:var(--sidebar);border:1px solid var(--border)">
            <p style="font-size:.85rem"><strong>Tipp:</strong> F√ºr Text√§nderungen frag einfach in Cursor ‚Äì ich helfe dir gerne!</p>
          </div>
        </div>

        <!-- Einstellungen -->
        <div id="einstellungen-panel" class="panel">
          <div class="section-title">GitHub Verbindung</div>
          <p style="font-size:.85rem;color:#666;margin-bottom:1rem">SEO-√Ñnderungen werden direkt in dein Repository geschrieben.</p>
          <div class="editor-group">
            <label>Personal Access Token</label>
            <input type="password" id="github-token" placeholder="ghp_...">
            <p class="hint"><a href="https://github.com/settings/tokens/new?scopes=repo&description=Admin%20Panel" target="_blank">Token erstellen ‚Üí</a> (repo Berechtigung)</p>
          </div>
          <div class="two-col">
            <div class="editor-group"><label>Repository</label><input type="text" id="github-repo" value="bschels/bschels.github.io"></div>
            <div class="editor-group"><label>Branch</label><input type="text" id="github-branch" value="main"></div>
          </div>
          <button id="test-github" class="btn-secondary">Verbindung testen</button>
          <span id="github-status" style="margin-left:.5rem;font-size:.85rem"></span>

          <div class="section-title" style="margin-top:2rem">Passwort √§ndern</div>
          <div class="two-col">
            <div class="editor-group"><label>Aktuelles Passwort</label><input type="password" id="pw-current"></div>
            <div class="editor-group"><label>Neues Passwort</label><input type="password" id="pw-new"></div>
          </div>
          <button id="change-pw" class="btn-secondary">Passwort √§ndern</button>
          <span id="pw-status" style="margin-left:.5rem;font-size:.85rem"></span>
        </div>
      </div>
    </main>
  </div>

  <div id="status-bar" class="status-bar"></div>

  <script>
(function(){
  'use strict';
  const $=id=>document.getElementById(id),$$=s=>document.querySelectorAll(s);
  const hash=s=>s.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0).toString(16);
  
  let hasChanges=false;
  
  function init(){
    if(!localStorage.getItem('admin_pw')){$('login-form').style.display='none';$('setup-box').style.display='block';}
    if(sessionStorage.getItem('admin_auth'))showAdmin();
    bindEvents();
  }
  
  function bindEvents(){
    $('set-pw-btn').onclick=()=>{
      const pw=$('new-password').value,c=$('confirm-password').value;
      if(pw.length<4)return $('setup-error').textContent='Mind. 4 Zeichen';
      if(pw!==c)return $('setup-error').textContent='Passw√∂rter stimmen nicht √ºberein';
      localStorage.setItem('admin_pw',hash(pw));location.reload();
    };
    $('login-form').onsubmit=e=>{
      e.preventDefault();
      if(hash($('password').value)===localStorage.getItem('admin_pw')){
        sessionStorage.setItem('admin_auth','1');showAdmin();
      }else $('login-error').textContent='Falsches Passwort';
    };
    $('logout-btn').onclick=()=>{sessionStorage.removeItem('admin_auth');location.reload();};
    $$('.nav-item').forEach(n=>n.onclick=e=>{
      e.preventDefault();
      $$('.nav-item').forEach(i=>i.classList.remove('active'));
      $$('.panel').forEach(p=>p.classList.remove('active'));
      n.classList.add('active');
      $(n.dataset.panel+'-panel').classList.add('active');
      $('panel-title').innerHTML=n.textContent+'<span class="unsaved-indicator'+(hasChanges?' active':'')+'"></span>';
    });
    $('save-btn').onclick=saveAll;
    $('preview-btn').onclick=()=>window.open('/','_blank');
    $('test-github').onclick=testGitHub;
    $('change-pw').onclick=changePw;
    
    // Track changes on SEO inputs
    ['seo-title','seo-description','seo-keywords','seo-og-title','seo-og-description'].forEach(id=>{
      $(id).addEventListener('input',markChanged);
    });
  }
  
  function showAdmin(){
    $('login-screen').style.display='none';
    $('admin-layout').classList.add('active');
    loadSettings();
    loadContent();
  }
  
  function markChanged(){
    hasChanges=true;
    $('unsaved')?.classList.add('active');
  }
  
  function loadSettings(){
    $('github-token').value=localStorage.getItem('gh_token')||'';
    $('github-repo').value=localStorage.getItem('gh_repo')||'bschels/bschels.github.io';
    $('github-branch').value=localStorage.getItem('gh_branch')||'main';
  }
  
  async function loadContent(){
    showStatus('Lade SEO-Daten...');
    try{
      const indexRes=await fetch('/index.html?t='+Date.now());
      if(!indexRes.ok)throw new Error('index.html nicht gefunden');
      const indexHtml=await indexRes.text();
      const doc=new DOMParser().parseFromString(indexHtml,'text/html');
      
      // Load SEO fields
      const title=$('seo-title');
      title.value=doc.querySelector('title')?.textContent||'';
      updateCharCount(title, 60);
      
      const desc=$('seo-description');
      desc.value=doc.querySelector('meta[name="description"]')?.content||'';
      updateCharCount(desc, 160);
      
      $('seo-keywords').value=doc.querySelector('meta[name="keywords"]')?.content||'';
      
      const ogTitle=$('seo-og-title');
      ogTitle.value=doc.querySelector('meta[property="og:title"]')?.content||'';
      updateCharCount(ogTitle, 60);
      
      const ogDesc=$('seo-og-description');
      ogDesc.value=doc.querySelector('meta[property="og:description"]')?.content||'';
      updateCharCount(ogDesc, 160);
      
      hasChanges=false;
      showStatus('SEO-Daten geladen ‚úì','success');
      setTimeout(hideStatus,2000);
    }catch(e){
      console.error(e);
      showStatus('Fehler: '+e.message,'error');
    }
  }
  
  async function saveAll(){
    const btn=$('save-btn');
    btn.disabled=true;btn.textContent='Speichert...';
    showStatus('Speichert SEO...');
    
    const token=localStorage.getItem('gh_token')||$('github-token').value;
    if(!token){
      showStatus('GitHub Token fehlt!','error');
      btn.disabled=false;btn.textContent='üíæ SEO Speichern';
      return;
    }
    
    localStorage.setItem('gh_token',$('github-token').value);
    localStorage.setItem('gh_repo',$('github-repo').value);
    localStorage.setItem('gh_branch',$('github-branch').value);
    
    try{
      const repo=localStorage.getItem('gh_repo');
      const branch=localStorage.getItem('gh_branch')||'main';
      
      // Fetch current index.html
      const ghRes=await fetch(`https://api.github.com/repos/${repo}/contents/index.html?ref=${branch}`,{
        headers:{Authorization:`token ${token}`}
      });
      if(!ghRes.ok)throw new Error('index.html nicht gefunden');
      const ghData=await ghRes.json();
      let html=decodeURIComponent(escape(atob(ghData.content)));
      
      // Update SEO meta tags using string replacement (safe, no DOM manipulation)
      const updates=[
        {regex:/<title>[^<]*<\/title>/,value:`<title>${escapeHtml($('seo-title').value)}</title>`},
        {regex:/<meta name="description" content="[^"]*"/,value:`<meta name="description" content="${escapeAttr($('seo-description').value)}"`},
        {regex:/<meta name="keywords" content="[^"]*"/,value:`<meta name="keywords" content="${escapeAttr($('seo-keywords').value)}"`},
        {regex:/<meta property="og:title" content="[^"]*"/,value:`<meta property="og:title" content="${escapeAttr($('seo-og-title').value)}"`},
        {regex:/<meta property="og:description" content="[^"]*"/,value:`<meta property="og:description" content="${escapeAttr($('seo-og-description').value)}"`}
      ];
      
      updates.forEach(u=>{
        html=html.replace(u.regex,u.value);
      });
      
      // Save to GitHub
      await saveFile('index.html',html,ghData.sha);
      
      hasChanges=false;
      $('unsaved')?.classList.remove('active');
      showStatus('SEO gespeichert ‚úì','success');
      setTimeout(hideStatus,3000);
    }catch(e){
      console.error(e);
      showStatus('Fehler: '+e.message,'error');
    }
    btn.disabled=false;btn.textContent='üíæ SEO Speichern';
  }
  
  function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
  function escapeAttr(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
  
  async function saveFile(path,content,sha){
    const token=localStorage.getItem('gh_token');
    const repo=localStorage.getItem('gh_repo');
    const branch=localStorage.getItem('gh_branch')||'main';
    
    const body={
      message:`SEO: ${path} aktualisiert`,
      content:btoa(unescape(encodeURIComponent(content))),
      branch,
      sha
    };
    
    const res=await fetch(`https://api.github.com/repos/${repo}/contents/${path}`,{
      method:'PUT',
      headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    
    if(!res.ok){
      const err=await res.json();
      throw new Error(err.message||'GitHub Fehler');
    }
  }
  
  async function testGitHub(){
    const token=$('github-token').value;
    const repo=$('github-repo').value;
    try{
      const r=await fetch(`https://api.github.com/repos/${repo}`,{headers:{Authorization:`token ${token}`}});
      if(r.ok){
        $('github-status').innerHTML='<span class="success">‚úì Verbunden</span>';
        localStorage.setItem('gh_token',token);
        localStorage.setItem('gh_repo',repo);
        localStorage.setItem('gh_branch',$('github-branch').value);
      }else{
        $('github-status').innerHTML='<span class="error">Fehler '+r.status+'</span>';
      }
    }catch(e){
      $('github-status').innerHTML='<span class="error">Verbindungsfehler</span>';
    }
  }
  
  function changePw(){
    const curr=$('pw-current').value,newPw=$('pw-new').value;
    if(hash(curr)!==localStorage.getItem('admin_pw'))return $('pw-status').innerHTML='<span class="error">Falsches Passwort</span>';
    if(newPw.length<4)return $('pw-status').innerHTML='<span class="error">Mind. 4 Zeichen</span>';
    localStorage.setItem('admin_pw',hash(newPw));
    $('pw-status').innerHTML='<span class="success">‚úì Ge√§ndert</span>';
    $('pw-current').value='';$('pw-new').value='';
  }
  
  function showStatus(msg,type=''){
    const el=$('status-bar');
    el.textContent=msg;
    el.className='status-bar active'+(type?' '+type:'');
  }
  function hideStatus(){$('status-bar').classList.remove('active');}
  
  // Global function for char count
  window.updateCharCount=function(el,max){
    const len=el.value.length;
    const countEl=$(el.id+'-count');
    if(countEl){
      countEl.textContent=`${len}/${max} Zeichen`;
      countEl.className='char-count';
      if(len>max)countEl.classList.add('error');
      else if(len>max*0.9)countEl.classList.add('warning');
    }
  };
  
  init();
})();
  </script>
</body>
</html>
